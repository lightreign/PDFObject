<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PDFObject: Code Generator</title>

  <style>
    body {
      font: 14px/120% sans-serif;
      margin: 0;
      padding: 2rem;
    }

    .columns {
      display: flex;
      flex-direction: row;
    }

    .column {
      flex: 1;
      margin: 0 1rem;
    }

    div:has(> label:first-child) {
      display: flex;
      width: 100%;
    }

    div label {
      width: 33%;
    }

    div input {
      width: 66%;
    }

    div input[type="checkbox"] {
      width: auto;
      flex: none;
    }

    #results {
      margin-bottom: 2rem;
      padding: 0;
    }

    h3 { 
      margin: 0 -2rem 2rem;
      padding: 1rem 2rem;
      background: rgba(0,0,0,.66);
      color: #fff; 
    }

    label {
      padding: .5rem;
      margin: 0;
      border-bottom: 1px solid rgba(0,0,0,.2);
    }

    input {
      padding: .5rem;
      margin: 0;
      border: none;
      border-bottom: 1px solid rgba(0,0,0,.2);
      background: rgba(0,0,0,.025);
    }

    input[type="checkbox"] {

    }

    select {
      padding: .25rem .5rem;
      border: none;
      border-bottom: 1px solid rgba(0,0,0,.2);
      background: rgba(0,0,0,.025);
      margin: 0;
      width: 67%;
    }

    textarea {
      font: 16px/120% monospace;
      overflow: auto;
      width: 95%;
      height: 250px;
      padding: 2rem;
      border: none;
      background: rgba(0,0,0,.025);
    }

    .errorMsg {
      color: red;
      margin-bottom: 1rem;
    }
  </style>
</head>

<body>

  <h2>PDFObject Code Generator</h2>

  <div id="app">

    <div id="results">
      <textarea v-model="generatedCode"></textarea>
    </div>

    <p class="errorMsg">
      <span v-if="!isSelectorValid">Selector must start with a . or #</span>
      <span v-if="!isValidPageNum">Page must be a whole number</span>
      <span v-if="!isValidId">ID must start with a letter and contain no spaces or special characters.</span>
      &nbsp;
    </p>

    <div>
      <label for="codeType">Do you want to use PDFObject or plain HTML?</label>
      <select v-model="codeType" id="codeType">
        <option value="js">PDFObject</option>
        <option value="html">HTML Markup Only</option>
      </select>
    </div>
    
    <div v-show="(this.codeType === 'html')">
      <label for="fillWindow">Would you like the PDF to fill the entire browser window?</label>
      <input type="checkbox" id="fillWindow" v-model="fillWindow" />
    </div>
    
    <div>
      <label for="pdfUrl">URL of your PDF:</label>
      <input id="pdfUrl" v-model="pdfUrl" />
    </div>
    
    <div v-show="(this.codeType === 'js')">
      
      <div>
        <label for="targetSelector">Selector for your target container:</label>
        <input id="targetSelector" v-model="targetSelector" @input="validateSelector" />
      </div>
      
      <div>
        <label for="setOptions">Would you like to specify any PDFObject options?</label>
        <input type="checkbox" id="setOptions" v-model="setOptions" />
      </div>
      
      <div v-show="setOptions">
        
        <h3>PDFObject Options</h3>
        <p>Placeholder values represent defaults</p>
        <div>
          <label for="page">Page (whole numbers only):</label>
          <input id="page" v-model="page" @input="validatePageNum" placeholder="1" />
        </div>
        
        <div>
          <label for="fallbackLink">Fallback link:</label>
          <input id="fallbackLink" v-model="fallbackLink" placeholder="&lt;p>This browser does not support inline PDFs. Please download the PDF to view it: &lt;a href='[url]'>Download PDF&lt;/a>&lt;/p>" />
        </div>
        
        <div>
          <label for="id">ID:</label>
          <input id="id" v-model="id" @input="validateId" />
        </div>
        
        <div>
          <label for="title">Title:</label>
          <input id="title" v-model="title" placeholder="Embedded PDF" />
        </div>
        
        <div>
          <label for="customAttributeKey">Custom attribute key:</label>
          <input id="customAttributeKey" v-model="customAttributeKey" />
        </div>
        
        <div>
          <label for="customAttributeValue">Custom attribute value:</label>
          <input id="customAttributeValue" v-model="customAttributeValue" />
        </div>
        
        <div>
          <label for="PDFJS_URL">PDFJS_URL:</label>
          <input id="PDFJS_URL" v-model="PDFJS_URL" />
        </div>
        
        <div>
          <label for="forcePDFJS">Force PDF.js (requires PDFJS_URL to be set):</label>
          <input type="checkbox" id="forcePDFJS" v-model="forcePDFJS" />
        </div>
        
        <div>
          <label for="omitInlineStyles">Omit inline styles:</label>
          <input type="checkbox" id="omitInlineStyles" v-model="omitInlineStyles" />
        </div>
        
        <div>
          <label for="height">Height:</label>
          <input id="height" v-model="height" placeholder="100%" />
        </div>
        
        <div>
          <label for="width">Width:</label>
          <input id="width" v-model="width" placeholder="100%" />
        </div>
        
        <div>
          <label for="suppressConsole ">Suppress console:</label>
          <input type="checkbox" id="suppressConsole " v-model="suppressConsole " />
        </div>
    
        <div>
          <label for="setPdfOpenParams">Would you like to specify PDF Open Parameters?</label>
          <input type="checkbox" id="setPdfOpenParams" v-model="setPdfOpenParams" />
        </div>
        
      </div><!-- /setOptions -->

    </div><!-- /js -->

    <div v-show="setOptions && setPdfOpenParams">
      <h3>PDF Open Parameters</h3>
      <p>Placeholder values represent examples of expected values for that particular parameter.</p>

      <div>
        <label for="nameddest">Named Destination:</label>
        <input id="nameddest" v-model="nameddest" :disabled="!!this.page" placeholder="anchor-id" />
      </div>

      <div>
        <label for="zoom">Zoom:</label>
        <input id="zoom" v-model="zoom" placeholder="100" />
      </div>

      <div>
        <label for="view">View:</label>
        <input id="view" v-model="view" placeholder="FitH" />
      </div>

      <div>
        <label for="pagemode">Page mode:</label>
        <select id="pagemode" v-model="pagemode">
          <option value="">Not specified</option>
          <option value="none">None</option>
          <option value="thumbs">Thumbnails</option>
          <option value="bookmarks">Bookmarks</option>
          <option value="attachments">Attachments</option>
        </select>
      </div>  

      <div>
        <label for="toolbar">Toolbar:</label>
        <select id="toolbar" v-model="toolbar">
          <option value="">Not specified</option>
          <option value="1">Show</option>
          <option value="0">Hide</option>
        </select>
      </div>  
      
      <div>
        <label for="navpanes">Navigation panes:</label>
        <select id="navpanes" v-model="navpanes">
          <option value="">Not specified</option>
          <option value="1">Show</option>
          <option value="0">Hide</option>
        </select>
      </div>  
      
      <div>
        <label for="scrollbar">Scrollbar:</label>
        <select id="scrollbar" v-model="scrollbar">
          <option value="">Not specified</option>
          <option value="1">Show</option>
          <option value="0">Hide</option>
        </select>
      </div>
      
      <div>
        <label for="statusbar">Statusbar:</label>
        <select id="statusbar" v-model="statusbar">
          <option value="">Not specified</option>
          <option value="1">Show</option>
          <option value="0">Hide</option>
        </select>
      </div>  
      <div>
        <label for="messages">Messages:</label>
        <select id="messages" v-model="messages">
          <option value="">Not specified</option>
          <option value="1">Show</option>
          <option value="0">Hide</option>
        </select>
      </div>  
      
      <div>
        <label for="reverse">Reverse page order:</label>
        <select id="reverse" v-model="reverse">
          <option value="">Not specified</option>
          <option value="1">Yes</option>
          <option value="0">No</option>
        </select>
      </div>  
      
      <div>
        <label for="search">Search:</label>
        <input id="search" v-model="search" placeholder="keyword" />
      </div>  

      <div>
        <label for="comment">Comment:</label>
        <input id="comment" v-model="comment" placeholder="e5c7bdc2-893f-4d44-9483-bc00dc9950cd" />
      </div>  

      <div>
        <label for="highlight">Highlight:</label>
        <input id="highlight" v-model="highlight" placeholder="200,200,200,200" />
      </div>

      <div>
        <label for="viewrect">Viewrect:</label>
        <input id="viewrect" v-model="viewrect" placeholder="200,200,100,100" />
      </div>

      <div>
        <label for="fdf">FDF:</label>
        <input id="fdf" v-model="fdf" placeholder="http://example.org/doc.fdf"/>
      </div>

      <div>
        <label for="collab">Collab:</label>
        <input id="collab" v-model="collab" placeholder="DAVFDF@http://review_server/Collab! /user1" />
      </div>

  </div><!-- /v-show="setOptions && setPdfOpenParams" -->

  </div><!-- /app -->

  <script src="https://unpkg.com/vue@3"></script>
  <script>
    // This function is used to remove double quotes from keys in a JSON string
    function stripQuotesFromKeys(jsonString) {
      // Regular expression to match double quotes around keys (words before colons)
      // This regex assumes that there are no colons, commas, or curly braces in the keys
      // and that keys do not contain escaped quotes.
      const regex = /"([^"]+)":/g;
      return jsonString.replace(regex, '$1:');
    }

    //if code type is HTML, generate an iframe with URL as src
    //if code type is JS, generate a PDFObject call and include the PDFObject JS file from CDN
    const app = Vue.createApp({
      data() {
        return {
          codeType: 'js',
          fillWindow: false,
          pdfUrl: 'path/to/file.pdf',
          targetSelector: '#myID',
          isSelectorValid: true,
          isValidPageNum: true,
          isValidId: true,
          setOptions: false,
          page: '',
          fallbackLink: '',
          id: '',
          title: '',
          customAttributeKey: '',
          customAttributeValue: '',
          PDFJS_URL: '',
          forcePDFJS: false,
          omitInlineStyles: false,
          height: '',
          width: '',
          suppressConsole: false,
          setPdfOpenParams: false,
          nameddest: '',
          zoom: '',
          view: '',
          pagemode: '',
          search: '',
          toolbar: '',
          navpanes: '',
          scrollbar: '',
          statusbar: '',
          messages: '',
          reverse: '',
          comment: '',
          highlight: '',
          viewrect: '',
          fdf: '',
          collab: ''
        }
      },
      computed: {
        generatedCode() {
          if (this.codeType === 'html') {
            return `<body>
<iframe src="${this.pdfUrl}" type="application/pdf" allow="fullscreen" frameborder="0" 
        style="border: none; width: 100%; height: 100%;${this.fillWindow ? ` position: absolute; top: 0; right: 0; bottom: 0; left: 0; ` : ''}">
</iframe>
</body>`;
          } else {
            return `<body>
<div ${this.targetElement}></div>

<script src="https://unpkg.com/pdfobject"><\/script>

<script>${this.setOptions && this.generatedOptions.length > 3 ? `
let options = ${this.generatedOptions};` : ''}
PDFObject.embed("${this.pdfUrl}", "${this.targetSelector}"${this.setOptions && this.generatedOptions.length > 3 ? ', options' : ''});
<\/script>
</body>`;
          }
        },
        generatedOptions() {
          let options = {};
          if (this.page && this.isValidPageNum) { options.page = this.page; }
          if (this.fallbackLink) { options.fallbackLink = this.fallbackLink; }
          if (this.id && this.isValidId) { options.id = this.id; }
          if (this.title) { options.title = this.title; }
          if (this.customAttributeKey && this.customAttributeValue) { 
            options.customAttribute = { key: this.customAttributeKey, value: this.customAttributeValue }; 
          }
          if (this.PDFJS_URL) { options.PDFJS_URL = this.PDFJS_URL; }
          if (this.forcePDFJS && this.PDFJS_URL) { options.forcePDFJS = this.forcePDFJS; }
          if (this.omitInlineStyles) { options.omitInlineStyles = this.omitInlineStyles; }
          if (this.height) { options.height = this.height; }
          if (this.width) { options.width = this.width; }
          if (this.suppressConsole) { options.suppressConsole = this.suppressConsole; }
          if(this.setPdfOpenParams && Object.keys(this.generatedPdfOpenParams).length > 0) { 
            options.pdfOpenParams = this.generatedPdfOpenParams; 
          }
          return stripQuotesFromKeys(JSON.stringify(options, null, 2));
        },
        generatedPdfOpenParams() {
          let params = {};
          if (this.nameddest) { params.nameddest = this.nameddest; }
          if (this.zoom) { params.zoom = this.zoom; }
          if (this.view) { params.view = this.view; }
          if (this.pagemode) { params.pagemode = this.pagemode; }
          if (this.search) { params.search = this.search; }
          if (this.toolbar) { params.toolbar = this.toolbar; }
          if (this.navpanes) { params.navpanes = this.navpanes; }
          if (this.scrollbar) { params.scrollbar = this.scrollbar; }
          if (this.statusbar) { params.statusbar = this.statusbar; }
          if (this.messages) { params.messages = this.messages; }
          if (this.reverse) { params.reverse = this.reverse; }
          if (this.comment) { params.comment = this.comment; }
          if (this.highlight) { params.highlight = this.highlight; }
          if (this.viewrect) { params.viewrect = this.viewrect; }
          if (this.fdf) { params.fdf = this.fdf; }
          if (this.collab) { params.collab = this.collab; }
          return params;
        },
        targetElement() {
          //only process if selector begins with # or .
          if (this.targetSelector.indexOf('#') !== 0 && this.targetSelector.indexOf('.') !== 0) {
            return '';
          }
          let attr = (this.targetSelector.indexOf('#') === 0) ? 'id' : 'class';
          return `${attr}="${this.targetSelector.slice(1)}"`;
        }
      },
      methods: {
        validateSelector() {
          // Check if the input starts with a . or #
          this.isSelectorValid = this.targetSelector.startsWith('.') || this.targetSelector.startsWith('#');
        },
        validatePageNum() {
          // Check if the input contains a whole number greater than 0, or is empty
          this.isValidPageNum = (Number.isInteger(Number(this.page)) && Number(this.page) > 0) || this.page === '';
        },
        validateId() {
            // Regular expression to check that the ID starts with a letter and only contains
            // letters, digits, hyphens, underscores, colons, and periods
            const idPattern = /^[a-zA-Z][a-zA-Z0-9-_.:]*$/;
            this.isValidId = idPattern.test(this.id) || this.id === '';
        },
      }
    }).mount('#app');

</script>

</body>

</html>